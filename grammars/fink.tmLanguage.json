{
	"name": "fink",
	"scopeName": "source.fink",
	"fileTypes": ["fnk"],

	"patterns": [
		{"include": "source.jsx.fink"},

		{"include": "#regex"},

		{"include": "#comments"},

		{"include": "#function-call"},

		{"include": "#block-like"},
		{"include": "#language-constant"},

		{"include": "#operators"},


		{"include": "#number"},
		{"include": "#string"},
		{"include": "#object"},

		{"include": "#variable"}
	],

	"repository": {

		"comments": {
			"patterns": [
				{
					"name": "comment.line.hash.fink",
					"match": "#.*$"
				},
				{
					"name": "comment.block.documentation.fink",
					"begin": "^\\s*(---)$",
					"end": "^\\s*(---)$",
					"beginCaptures": {
						"1": {"name": "punctuation.definition.comment.begin.fink"}
					},
					"endCaptures": {
						"0": {"name": "punctuation.definition.comment.end.fink"}
					},
					"patterns": [
						{"include": "#comment-content"}
					]
				}
			]
		},
		"comment-content": {
      "patterns": [
				{
					"name": "meta.embedded.block.fink",
					"begin": "(```)",
					"end": "(```)",
					"patterns": [
						{"include": "$base"}
					]
        }
      ]
		},

		"block-like": {
			"patterns": [
				{
					"begin": "(fn|match|fold|unfold|map|flat_map|filter|while|pipe)",
					"end": "(:)",
					"contentName": "meta.function.parameters",
					"beginCaptures": {
						"1": {"name": "keyword.control.block.$1.fink"}
					},
					"patterns": [
						{
							"match": ",",
							"name": "meta.delimiter.comma.fink"
						},
						{"include": "$base"}
					]
				},
				{
					"match": "\\b(else|attempt):",
					"captures": {
						"1": {"name": "keyword.control.block.$1.fink"}
					}
				}
			]
		},

		"operators": {
			"patterns": [
				{
          "match": "(?<!\\.)\\s*+\\b(import)\\b",
          "captures": {
            "1": {"name": "keyword.control.module.$1.fink"}
          }
				},
				{
          "match": "(?<!\\.)\\s*+\\b(await|throw)\\b",
          "captures": {
            "1": {"name": "keyword.control.flow.$1.fink"}
          }
				},
				{
          "match": "(?<!\\.)\\s*+\\b(new)\\b",
          "captures": {
            "1": {"name": "keyword.operator.$1.fink"}
          }
				},
				{
          "match": "!|&&|\\|\\|",
          "name": "keyword.operator.logical.fink"
				},
				{
          "match": "=(?!(=))",
          "name": "keyword.operator.assignment.fink"
				},
				{
          "match": "<=|>=|<>|<|>",
          "name": "keyword.operator.relational.fink"
				},
				{
          "match": "==|!=",
          "name": "keyword.operator.comparison.fink"
				},
				{
          "match": "-|\\+|%|\\*|/|\\^",
          "name": "keyword.operator.arithmetic.fink"
				},

				{
					"match": "(\\.)(\\w+?)\\b(?![:(])",
					"captures": {
						"1": {"name": "punctuation.accessor.fink"},
						"2": {"name": "string.unquoted.fink"}
					}
				}
			]
		},

		"number": {
			"patterns": [
        {
          "match": "\\s*+((?:\\B[-+])?(?:\\b0[bB][_0-1]*|\\b0[oO][_0-7]*|\\b0[xX][_0-9a-fA-F]*|(\\B\\.[_0-9]+|\\b[0-9]+(\\.[_0-9]*)?)([eE][-+]?[_0-9]+)?))(n\\b)?",
          "captures": {
            "1": {"name": "constant.numeric.fink"},
            "5": {"name": "constant.numeric.bigint.fink"}
          }
        }
      ]
		},

		"variable": {
      "patterns": [
        {
          "match": "\\b(\\w+?)\\b",
          "captures": {
            "1": {"name": "variable.other.readwrite.fink"}
          }
        }
      ]
		},

		"function-call": {
			"patterns": [
				{
					"name": "meta.function-call.fink",
					"begin": "\\b(\\w*+)\\s*+(\\()",
					"end": "\\)",
					"contentName": "meta.function.parameters",
					"beginCaptures": {
						"1": {"name": "entity.name.function.fink"},
						"2": {"name": "meta.brace.round"}
					},
					"endCaptures": {
						"0": {"name": "meta.brace.round"}
					}
				},
				{
					"name": "meta.function-call.fink",
					"match": "\\b(\\w*+)\\s*+(::)",
					"captures": {
						"1": {"name": "entity.name.function.fink"},
						"2": {"name": "keyword.operator.call.fink"}
					}
				}
			]
		},

		"object": {
			"begin": "{",
			"end": "}",
			"patterns": [
				{
					"match": ",",
					"name": "meta.delimiter.comma.fink"
				},
				{
					"match": "\\s*+(\\w+?)\\s*+:(?!:)",
					"captures": {
						"1": {"name": "string.unquoted"}
					}
				},
				{"include": "$base"}
			]
		},

		"string": {
			"patterns": [
				{
					"name": "string.quoted.template.fink",
					"begin": "(\\w*)(`)(?!``)",
					"end": "`",
					"beginCaptures": {
						"1" : {"name": "entity.name.function.tagged-string.fink"},
						"2": {"name": "punctuation.definition.string.begin.fink"}
					},
					"endCaptures": {
						"0": {"name": "punctuation.definition.string.end.fink"}
					},
					"patterns": [
						{"include": "#string-content"}
					]
				},
				{
					"name": "string.quoted.template.fink",
					"begin": "(\\w*)(')",
					"end": "'",
					"beginCaptures": {
						"1" : {"name": "entity.name.function.tagged-string.fink"},
						"2": {"name": "punctuation.definition.string.begin.fink"}
					},
					"endCaptures": {
						"0": {"name": "punctuation.definition.string.end.fink"}
					},
					"patterns": [
						{"include": "#string-content"}
					]
				},
				{
					"name": "string.quoted.template.fink",
					"begin": "(\\w*)(\")",
					"end": "\"",
					"beginCaptures": {
						"1" : {"name": "entity.name.function.tagged-string.fink"},
						"2": {"name": "punctuation.definition.string.begin.fink"}
					},
					"endCaptures": {
						"0": {"name": "punctuation.definition.string.end.fink"}
					},
					"patterns": [
						{"include": "#string-content"}
					]
				}
			]
		},
		"string-content": {
      "patterns": [
				{
          "name": "constant.character.escape.quasi.element.fink",
					"begin": "\\${",
					"end": "}",
					"patterns": [
						{"include": "$base"}
					]
        },
        {
          "name": "constant.character.escape",
          "match": "\\\\[`'\"\\\\nrtbfv0]"
        },
        {
          "name": "constant.character.escape",
          "match": "\\\\u(({[0-9a-fA-F]+\\})|[0-9a-fA-F]{4})"
        },
        {
          "name": "constant.character.escape",
          "match": "\\\\x[0-9a-fA-F]{2}"
        }
      ]
		},

		"regex": {
      "patterns": [
				{
          "name": "string.regexp.fink",
          "begin": "(rx?)(/)",
          "end": "(/)([gimyu]*)",
          "beginCaptures": {
						"1": {"name": "keyword.control.fink"},
						"2": {"name": "punctuation.definition.regexp.begin.fink"}
          },
          "endCaptures": {
            "1": {"name": "punctuation.definition.regexp.end.fink"},
            "2": {"name": "keyword.other.fink"}
          },
          "patterns": [
            {"include": "source.regexp.fink"}
          ]
				}
      ]
    },

		"language-constant": {
      "patterns": [
        {
          "match": "(?<!\\.)\\s*+\\b(true|false|null)\\b",
          "captures": {
            "1": {"name": "constant.language.boolean.$1.fink"}
          }
        }
      ]
		}
	}
}